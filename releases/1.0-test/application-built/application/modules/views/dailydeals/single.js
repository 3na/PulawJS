define(["text!templates/dailydeals/single.html","countdown"],function(template){var View=Backbone.View.extend({events:{"click #mapBtn":"showMap","click #listBtn":"showListing"},showMap:function(){$(".content-primary").css("display","none"),$("#map_canvasContainer").css({left:"0px"})},showListing:function(){$(".content-primary").css("display","block"),$("#map_canvasContainer").css({left:"2000px"})},template:_.template(template),render:function(postId){$.mobile.showPageLoadingMsg();var params={source:"listing_details",list_id:postId};return $.ajax({url:"/json_api",type:"get",dataType:"json",data:params,success:$.proxy(function(response){$.mobile.hidePageLoadingMsg(),$(this.el).html(this.template({deal:response})),$("body").append($(this.el));var longitude=response.fields.longitude[0],latitude=response.fields.latitude[0],infoBubble=response.fields.address[0];$.mobile.changePage($(this.el),{changeHash:!1}),this.firstPage=!1,setTimeout(function(){console.log("showing"),App.prepareMap("#map_canvas",15),app.addMarker(app.get("geocoords").latitude,app.get("geocoords").longitude,"You are here","/wp-content/themes/bazaar/mobile/public/images/marker-current.png",[50,50]),App.addMarker(latitude,longitude,infoBubble,"",[50,50])},500)},this)}),this.delegateEvents(),this}});return new View})