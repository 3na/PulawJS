define(["text!templates/index/single.html","photo-swipe.class","photo-swipe"],function(template){var View=Backbone.View.extend({events:{"click #mapBtn":"showMap","click #listBtn":"showListing"},showMap:function(){$("#map_canvasContainer").css("left","0px"),$(".content-primary").css("display","none")},showListing:function(){$("#map_canvasContainer").css("left","2000px"),$(".content-primary").css("display","block")},template:_.template(template),render:function(postId){$.mobile.showPageLoadingMsg();var params={source:"listing_details",list_id:postId};return $.ajax({url:"/json_api",type:"get",dataType:"json",data:params,success:$.proxy(function(response){$.mobile.hidePageLoadingMsg(),$(this.el).html(this.template({listing:response})),$("body").append($(this.el)),$.mobile.changePage($(this.el),{changeHash:!1}),this.firstPage=!1;var longitude=parseFloat(response.fields.custom_field5[0]),latitude=parseFloat(response.fields.custom_field6[0]),infoBubble='<img src="'+response.thumbnail+'" /><br />'+response.fields.custom_field2[0];setTimeout(function(){App.prepareMap("#map_canvas",15),app.addMarker(app.get("geocoords").latitude,app.get("geocoords").longitude,"You are here","/wp-content/themes/bazaar/mobile/public/images/marker-current.png",[50,50]),App.addMarker(latitude,longitude,infoBubble,"/wp-content/themes/bazaar/mobile/public/images/marker-current.png",[50,50]);var options={backButtonHideEnabled:!0};gallery=Code.PhotoSwipe.attach(window.document.querySelectorAll("#gallery a"),options)},100)},this)}),this.delegateEvents(),this}});return new View})