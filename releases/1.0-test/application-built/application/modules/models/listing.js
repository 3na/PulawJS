define(["google","models/app.model"],function(google,o){var coords=app.get("geocoords"),Listing=Backbone.Model.extend({defaults:{region:"toronto",category:"",order:"desc",num:9,orderby:"date",offset:1,listing_type:"all",search_for:"",lat:coords.latitude,lon:coords.longitude,circumference:15},renderListingResponse:function(){$.mobile.showPageLoadingMsg(),$.ajax({url:"/json_api",data:AppMarket.attributes,dataType:"json",type:"get",success:function(data){$(".listings").css("display","block"),$.mobile.hidePageLoadingMsg(),app.addMarker(app.get("geocoords").latitude,app.get("geocoords").longitude,"You are here","/wp-content/themes/bazaar/mobile/public/images/marker-current.png",[50,50]);var template=_.template('<li><a class="<%=page%>" data-transition="flip" href="#<%=page%>/<%=id%>"><img src="<%=thumbnail%>" /><h3><%=title%></h3><p>approximately <strong><%=miles%></strong> mi near you</strong></p><p><%=address%></p></a></li>'),oodleSingle=_.template("oodle/<%=category%>/<%=circumference%>/<%=lat%>_<%=lon%>/<%=num%>/<%=offset%>/<%=order%>/<%=orderby%>/<%=region%>");data.listings.length>=1?($.each(data.listings,function(key,value){var infoBubble=value.title+"<hr/><br /><b>"+value.address+"</b>";if(value.author_name=="Powered By Oodle")var page=oodleSingle(AppMarket.attributes);else var page="post";app.addMarker(value.lat,value.lon,infoBubble,"",[20,20]),$("#MarketItemList").append(template({page:page,id:value.ID,thumbnail:value.thumbnail,title:value.title,address:value.address,miles:value.distance}))}),data.paginate_total>=1&&$("#showmoreBtn").css("display","block"),$("#MarketItemList").listview("refresh")):($("#noresultDisplay").css("display","block"),$(".listings").css("display","none")),$.mobile.hidePageLoadingMsg()},error:function(){$.mobile.hidePageLoadingMsg(),$("#noresultDisplay").css("display","block")}})},getPost:function(id){$.mobile.showPageLoadingMsg();var postAttributes={source:"listing_details",list_id:id};$.ajax({url:"/json_api",data:postAttributes,dataType:"json",type:"get",success:function(data){console.log(data),$.mobile.hidePageLoadingMsg()}})}});return window.AppMarket=new Listing,AppMarket})